<!--begin::App Content Header-->
<div class="app-content-header">
  <!--begin::Container-->
  <div class="container-fluid">
    <div class="container-fluid">
      <div class="row">
        <div class="col-9">
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
            <i class="bi bi-plus-lg"></i> Add Product
          </button>
        </div>
        <div class="col-3">
          <div class="mb-3 position-relative">
            <input 
              type="text" 
              class="form-control" 
              id="floatingInput"
              placeholder="Search products..."
              [ngModel]="searchTerm"
              (ngModelChange)="onSearch($event)">
            <i class="bi bi-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"></i>
          </div>
        </div>
      </div>
      <!--begin::Row-->
      <div class="row">
        <div class="col-sm-6">
          <h3 class="mb-0">Products</h3>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-end">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Products</li>
          </ol>
        </div>
      </div>
      <!--end::Row-->
    </div>
    <!--end::Container-->
  </div>
  <div class="app-content">
    <!--begin::Container-->
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <!-- Error State -->
          @if (error) {
            <div class="alert alert-danger" role="alert">
              <i class="bi bi-exclamation-triangle-fill"></i> {{ error }}
              <button class="btn btn-outline-danger btn-sm ms-2" (click)="loadProducts()">
                Retry
              </button>
            </div>
          }

          <!-- Loading State -->
          @defer (on timer(2000ms)) {
            @if (products.length === 0 && !error) {
              <div class="alert alert-info" role="alert">
                <i class="bi bi-info-circle-fill"></i> No products found.
              </div>
            }

            @if (filteredProducts.length > 0) {
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Item</th>
                    <th scope="col">Qty</th>
                    <th scope="col">Price</th>
                    <th scope="col">Dis (%)</th>
                    <th scope="col">CategoryID</th>
                    <th scope="col">Total</th>
                    <th scope="col">Grand Total</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of filteredProducts; track item.productid) {
                    <tr [class.table-secondary]="$index % 2 === 0">
                      <th scope="row" [class.table-info]="$index % 2 === 0">{{item.productid}}</th>
                      <td>{{item.item}}</td>
                      <td>{{item.qty}}</td>
                      <td>{{item.price | currency}}</td>
                      <td>{{item.discount}}</td>
                      <td>{{item.categoryid}}</td>
                      <td>{{item.total | currency}}</td>
                      <td>{{item.grandTotal | currency}}</td>
                      <td>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle bg-light text-black" type="button" 
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Actions
                          </button>
                          <ul class="dropdown-menu">
                            <li>
                              <button class="dropdown-item" (click)="deleteProduct(item.productid)">
                                <i class="bi bi-trash"></i> Delete
                              </button>
                            </li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-pencil"></i> Edit</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-eye"></i> View</a></li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            }
          } @placeholder {
            <div class="loading-overlay">
              <div class="text-center">
                <img src="img/loading.gif" alt="Loading..." class="mb-2">
                <p>Loading products...</p>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content-->
</div>

<!-- Product Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Add New Product</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="productTitle" class="form-label">Product Title</label>
            <input type="text" class="form-control" id="productTitle" placeholder="Samsung S20">
          </div>
          <div class="mb-3">
            <label for="productSize" class="form-label">Size</label>
            <input type="text" class="form-control" id="productSize" placeholder="Enter Size">
          </div>
          <div class="mb-3">
            <label for="productCategory" class="form-label">Category</label>
            <input type="text" class="form-control" id="productCategory" placeholder="Enter category">
          </div>
          <div class="mb-3">
            <label for="productImage" class="form-label">Image URL</label>
            <input type="url" class="form-control" id="productImage" placeholder="Enter image URL">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Add Product</button>
      </div>
    </div>
  </div>
</div>
